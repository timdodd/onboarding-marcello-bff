<hr/>
<header class="display-4">User Details</header>
<hr/>
<div class="row" mb-5>
  <div class="col-md-8">
    <form [formGroup]="formGroup">
      <div class="form-group">
        <label for="firstName">First name</label>
        <input type="text" class="form-control" id="firstName" formControlName="firstName">
        <small *ngIf="firstNameControl.errors" class="text-danger">{{firstNameControl.errors}}</small>
      </div>
      <div class="form-group">
        <label for="lastName">Last Name</label>
        <input type="text" class="form-control" id="lastName" formControlName="lastName">
        <small *ngIf="lastNameControl.errors" class="text-danger">{{lastNameControl.errors}}</small>
      </div>
      <div class="form-group">
        <label for="username">Username</label>
        <input type="text"
               [class.is-invalid]="usernameControl.errors"
               class="form-control" id="username" formControlName="username">
        <small *ngIf="usernameControl.errors" class="text-danger">{{usernameControl.errors}}</small>
      </div>
        <table class="table form-group">
          <thead>
            <tr *ngIf="phoneHeadersVisible() === true">
              <th>Phone Numbers</th>
              <th>Primary</th>
              <th *ngIf="userExists() === true">Verified</th>
              <th></th>
<!--              <th>-->
<!--&lt;!&ndash;              <a class="btn btn-primary p-1 m-0 border-0" (click)="newPhone(null)">Add</a>&ndash;&gt;-->
<!--              </th>-->
            </tr>
          </thead>
          <tbody formArrayName="phones">
          <tr [formGroup]="formGroup" *ngFor="let phone of phonesControl.controls; let i = index"
              formGroupName="{{i}}">
<!--            <small *ngIf="phonesControl.errors" class="text-danger">{{phone.errors}}</small>-->
            <td>
              <input type="tel" pattern="\([0-9]{3}\)[0-9]{3}[-][0-9]{4}" [class.is-invalid]="phone.errors"
                     class="form-control" formControlName="phoneNumber">
              <small *ngIf="phone.errors" class="text-danger">{{phone.errors}}</small>
            </td>
            <td>
              <div class="form-check mt-1">
                <!--                ask about the radio buttons - may need to check that I'm loading forms correctly-->
                <input type="radio" class="form-check-input" [value]="isPrimaryPhone(i)" name="primary"
                       [checked]="isPrimaryPhone(i) === true" (change)="changePrimary(i)">
              </div>
            </td>
            <td *ngIf="userExists() === true">
              <div class="form-check" *ngIf="checkVerified(i) === true">
                <input type="checkbox" class="form-check-input" id="verified${i}"
                       formControlName="verified" disabled="primaryPhoneCheckboxDisabled">
              </div>
              <button type="button" class="btn btn-sm btn-link pt-0 mt-0 border-0"
                      (click)="verifyPhone(i)" *ngIf="checkVerified(i) === false">Verify</button>
            </td>
            <td *ngIf="userExists() === true">
              <button type="button" class="btn btn-link btn-sm pt-0 mt-0 border-0" tooltip="Delete phone."
                      (click)='deletePhone(phone)'>Delete</button>
            </td>
          </tr>
          <tr *ngIf="newPhoneRowVisible == false">
            <td colspan="4" style="text-align:center;">
              <a class="btn btn-sm btn-primary pt-0 border-0" (click)="showPhoneForm()">+ Add New Phone</a>
            </td>
          </tr>
          <tr [formGroup]="newPhoneFormGroup" *ngIf="newPhoneRowVisible">
            <td>
              <small for="phoneNumber">Enter 10-digit number:</small>
              <input (keyup)="onKeyUp($event)" type="tel" pattern="\([0-9]{3}\)[0-9]{3}[-][0-9]{4}" id='phoneNumber'
                     formControlName="phoneNumber" class="form-control mt-2" placeholder="xxxxxxxxxx"
                     (change)="changeFormatError()">
              <small *ngIf="newPhoneNumberControl.errors" class="text-danger">
                {{newPhoneErrorMessages}}</small>
<!--              <small *ngIf="addPhoneMessageVisible" class="text-danger">Add phone before saving.</small>-->
            </td>
            <td>
              <small class="" for="primaryNumber">Primary:</small><!--              Set as Primary-->
              <div class="form-check">
                <input type="checkbox" class="form-check-input mt-3 position-static float-left"
                       id="primaryNumber" [checked]="isFirstPhone() === true" [value]="newPhonePrimaryControl"
                       (change)="primaryCheckboxChange()">
              </div>
            </td>
            <td >
              <div class="mt-2">
                <a class="btn btn-sm btn-primary mt-4" (click)="addNewPhone()">Add</a>
              </div>
            </td>
            <td >
              <div class="mt-2">
                <a class="btn btn-sm btn-link mt-4" (click)="cancelPhone()">Cancel</a>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
    </form>
    <hr/>
    <button class="btn btn-primary" (click)="save()">Save</button>
    <button class="btn btn-link" (click)="cancel()">Cancel</button>
<!--    <button class="btn btn-link float-right"  (click)='delete()'>Delete</button>-->
  </div>
</div>
